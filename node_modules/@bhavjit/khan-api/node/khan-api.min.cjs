/**
 * Khan API v0.5.2
 * https://khan-api.bhavjit.com
 * Licensed under MIT license
 * Copyright 2023 Bhavjit Chauhan
 */

"use strict";var xe=Object.defineProperty;var Ir=Object.getOwnPropertyDescriptor;var Er=Object.getOwnPropertyNames;var Ar=Object.prototype.hasOwnProperty;var Ie=(a,r)=>{for(var e in r)xe(a,e,{get:r[e],enumerable:!0})},Kr=(a,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of Er(r))!Ar.call(a,o)&&o!==e&&xe(a,o,{get:()=>r[o],enumerable:!(t=Ir(r,o))||t.enumerable});return a};var Ur=a=>Kr(xe({},"__esModule",{value:!0}),a);var Ee=(a,r,e)=>{if(!r.has(a))throw TypeError("Cannot "+e)};var l=(a,r,e)=>(Ee(a,r,"read from private field"),e?e.call(a):r.get(a)),K=(a,r,e)=>{if(r.has(a))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(a):r.set(a,e)},fe=(a,r,e,t)=>(Ee(a,r,"write to private field"),t?t.call(a,e):r.set(a,e),e);var g=(a,r,e)=>(Ee(a,r,"access private method"),e);var Zr={};Ie(Zr,{Answer:()=>U,BaseMessage:()=>L,Client:()=>i,EmailRegex:()=>Ne,EmailRegexMatch:()=>Or,FeedbackFocusKind:()=>be,FeedbackKeyRegex:()=>Le,FeedbackKeyRegexMatch:()=>Mr,FeedbackSort:()=>ze,FeedbackType:()=>me,FeedbackTypename:()=>wr,GoogleIDRegex:()=>ae,GoogleIDRegexMatch:()=>Nr,KaidRegex:()=>ve,KaidRegexMatch:()=>Cr,ListProgramSortOrder:()=>Xe,MESSAGE_ENCRYPTED_KEY_LENGTHS:()=>Vr,MESSAGE_KEY_LENGTHS:()=>Lr,Message:()=>d,MessageEncryptedKeyRegex:()=>Me,MessageEncryptedKeyRegexMatch:()=>Qr,MessageType:()=>G,PROGRAM_ID_LENGTHS:()=>yr,PROGRAM_KEY_LENGTHS:()=>hr,PROGRAM_URL_LOCALES:()=>fr,PROGRAM_URL_PATHS:()=>Fe,PROGRAM_URL_TLDS:()=>gr,Program:()=>R,ProgramEditorType:()=>Ze,ProgramIDRegex:()=>ke,ProgramIDRegexMatch:()=>Ce,ProgramImagePathRegex:()=>re,ProgramImagePathRegexMatch:()=>Dr,ProgramKeyRegex:()=>qe,ProgramKeyRegexMatch:()=>qr,ProgramType:()=>tr,ProgramURLRegex:()=>N,ProgramURLRegexMatch:()=>Fr,QualarooIDRegex:()=>te,QualarooIDRegexMatch:()=>Br,Question:()=>k,Reply:()=>E,ServiceErrorCode:()=>kr,ServiceErrorName:()=>br,TipsAndThanks:()=>S,TypeToClass:()=>lr,User:()=>b,UserAccessLevel:()=>_r,assertDataResponse:()=>h,avatarNameToSlug:()=>$r,avatarNames:()=>or,avatarSlugToName:()=>Hr,avatarSlugs:()=>sr,convertAvatarPNGToSVG:()=>Wr,convertAvatarSVGToPNG:()=>jr,extractAvatarSlug:()=>ue,generateAvatarPNG:()=>Pe,generateAvatarSVG:()=>we,isAnswerSchema:()=>Jr,isDataResponse:()=>Pr,isEmail:()=>P,isEncryptedFeedbackKey:()=>_,isFeedbackKey:()=>f,isGoogleID:()=>Ve,isInputErrorResponse:()=>Sr,isKaid:()=>m,isProgramID:()=>Q,isProgramKey:()=>B,isProgramURL:()=>De,isQualarooID:()=>Qe,isQuestionSchema:()=>ir,isReplySchema:()=>Yr,isServiceErrorsResponse:()=>Rr,isTipsAndThanksSchema:()=>nr,mutations:()=>Je,programIDtoKey:()=>Gr,programKeyToID:()=>er,queries:()=>Ye,resolveFeedbackKey:()=>ar,resolveKaid:()=>_e,resolveProgramID:()=>J,resolveUsername:()=>rr});module.exports=Ur(Zr);var Ye={};Ie(Ye,{AvatarDataForProfile:()=>Ke,FeedbackQuery:()=>Ue,GetFeedbackReplies:()=>Te,GetFullUserProfile:()=>Be,GetProfileWidgets:()=>Oe,GetUserByUsernameOrEmail:()=>Ge,GetUserHoverCardProfile:()=>$e,ProgramQuery:()=>He,ProjectsAuthoredByUser:()=>je,QAExpandKeyInfo:()=>pe,QaExpandKeyInfo:()=>We,avatarDataForProfile:()=>ee,feedbackQuery:()=>j,getFeedbackReplies:()=>W,getFullUserProfile:()=>oe,getProfileWidgets:()=>se,getUserByUsernameOrEmail:()=>ne,getUserHoverCardProfile:()=>ie,programQuery:()=>le,projectsAuthoredByUser:()=>de});var p="https://www.khanacademy.org/api/internal/graphql",Ae=`bhavjitchauhan/khan-api_${Date.now()}`,cr=4669512406581248;async function Tr(a,r){return await fetch(a,r)}async function vr(a,r,e){return e={method:"post",body:JSON.stringify(r),...e},await Tr(a,e)}async function c(a,r,e={},t){return await vr(a,{query:r,variables:e},t)}var Ke;(r=>r.query=`query avatarDataForProfile($kaid: String!) {
  user(kaid: $kaid) {
    id
    avatar {
      name
      imageSrc
      __typename
    }
    __typename
  }
}
`)(Ke||={});function ee(a,r){return c(`${p}/avatarDataForProfile`,Ke.query,typeof a=="string"?{kaid:a}:a,r)}var Ue;(r=>r.query=`query feedbackQuery($topicId: String!, $focusKind: String!, $cursor: String, $limit: Int, $feedbackType: FeedbackType!, $currentSort: Int, $qaExpandKey: String) {
  feedback(focusId: $topicId, cursor: $cursor, limit: $limit, feedbackType: $feedbackType, focusKind: $focusKind, sort: $currentSort, qaExpandKey: $qaExpandKey, answersLimit: 1) {
    feedback {
      replyCount
      appearsAsDeleted
      author {
        id
        kaid
        nickname
        avatar {
          name
          imageSrc
          __typename
        }
        __typename
      }
      badges {
        name
        icons {
          smallUrl
          __typename
        }
        description
        __typename
      }
      content
      date
      definitelyNotSpam
      deleted
      downVoted
      expandKey
      feedbackType
      flaggedBy
      flaggedByUser
      flags
      focusUrl
      focus {
        kind
        id
        translatedTitle
        relativeUrl
        __typename
      }
      fromVideoAuthor
      key
      lowQualityScore
      notifyOnAnswer
      permalink
      qualityKind
      replyCount
      replyExpandKeys
      showLowQualityNotice
      sumVotesIncremented
      upVoted
      ... on QuestionFeedback {
        hasAnswered
        answers {
          replyCount
          appearsAsDeleted
          author {
            id
            kaid
            nickname
            avatar {
              name
              imageSrc
              __typename
            }
            __typename
          }
          badges {
            name
            icons {
              smallUrl
              __typename
            }
            description
            __typename
          }
          content
          date
          definitelyNotSpam
          deleted
          downVoted
          expandKey
          feedbackType
          flaggedBy
          flaggedByUser
          flags
          focusUrl
          focus {
            kind
            id
            translatedTitle
            relativeUrl
            __typename
          }
          fromVideoAuthor
          key
          lowQualityScore
          notifyOnAnswer
          permalink
          qualityKind
          replyCount
          replyExpandKeys
          showLowQualityNotice
          sumVotesIncremented
          upVoted
          __typename
        }
        isOld
        answerCount
        __typename
      }
      ... on AnswerFeedback {
        question {
          replyCount
          appearsAsDeleted
          author {
            id
            kaid
            nickname
            avatar {
              name
              imageSrc
              __typename
            }
            __typename
          }
          badges {
            name
            icons {
              smallUrl
              __typename
            }
            description
            __typename
          }
          content
          date
          definitelyNotSpam
          deleted
          downVoted
          expandKey
          feedbackType
          flaggedBy
          flaggedByUser
          flags
          focusUrl
          focus {
            kind
            id
            translatedTitle
            relativeUrl
            __typename
          }
          fromVideoAuthor
          key
          lowQualityScore
          notifyOnAnswer
          permalink
          qualityKind
          replyCount
          replyExpandKeys
          showLowQualityNotice
          sumVotesIncremented
          upVoted
          __typename
        }
        __typename
      }
      __typename
    }
    cursor
    isComplete
    sortedByDate
    __typename
  }
}
`)(Ue||={});function j(a,r){return c(`${p}/feedbackQuery`,Ue.query,a,r)}var Te;(r=>r.query=`query getFeedbackReplies($postKey: String!) {
  feedbackReplies(feedbackKey: $postKey) {
    expandKey
    appearsAsDeleted
    author {
      id
      kaid
      nickname
      avatar {
        name
        imageSrc
        __typename
      }
      __typename
    }
    content
    date
    definitelyNotSpam
    deleted
    downVoted
    expandKey
    feedbackType
    flaggedBy
    flaggedByUser
    flags
    focusUrl
    fromVideoAuthor
    key
    lowQualityScore
    notifyOnAnswer
    permalink
    qualityKind
    replyCount
    replyExpandKeys
    showLowQualityNotice
    sumVotesIncremented
    upVoted
    __typename
  }
}
`)(Te||={});function W(a,r){return c(`${p}/getFeedbackReplies`,Te.query,typeof a=="string"?{postKey:a}:a,r)}function mr(a,r,e="..."){return r=Math.max(0,r),a.length>r?a.slice(0,r-e.length)+e:a}function he(a){return a.replace(/-/g,"+").replace(/_/g,"/")}function ur(a){return a.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function C(a){return new RegExp(`(${a.source.slice(1,-1)})`)}var ve=/^kaid_\d{20,25}$/,Cr=C(ve),m=a=>ve.test(a),yr=[9,10,16],ke=new RegExp(`^[1-9](?:(?:${yr.map(a=>`\\d{${a-1}}`).join("|")}))$`),Ce=new RegExp(`(?:^|\\D)(${ke.source.slice(1,-1)})(?:$|\\D)`);function Q(a){return ke.test(a.toString())}var gr=["com","org"],fr=["as","az","cs","da","el","gu","hu","id","it","lt","ja","kk","kn","ky","lv","mn","mr","my","nl","pt-pt","ru","sv","ta","uz","bg","bn","de","en","es","fr","hi","hy","ka","km","ko","nb","pa","pl","pt","ro","sr","tr","vi","zh-hans","sgn-us"],Fe=["computer-programming","cs","pixar","nasa","piab-sandbox","computer-science","hour-of-code","math","differential-equations","electrical-engineering","mcat","apchem-topic","chemistry","art-history-basics","biology"],N=new RegExp(`^https?:\\/\\/(?:(?:www|${fr.join("|")})\\.)?khanacademy\\.(?:${gr.join("|")})\\/(?:${Fe.join("|")})\\/[\\w\\d-.~()'!*:@,;]+\\/(${ke.toString().slice(2,-2)})$`,"i"),Fr=C(N);function De(a){return N.test(a)}var re=new RegExp(`^\\/(?:${Fe.join("|")})\\/[\\w\\d-.~()'!*:@,;]+\\/\\d+\\/(\\d+)\\.png$`),Dr=C(re),hr=[51,54],qe=/^ag5zfmtoYW4tYWNhZGVteXI(?:U|X)CxIKU2NyYXRjaHBhZB(?:i|j)(?=[\w-]*$)(?:.{7}w|.{9}C(?:g|w|A|Q)w)$/,qr=C(qe);function B(a){if(hr.includes(a.length)||!qe.test(a))return!1;try{return atob(he(a)),!0}catch{return!1}}var Lr=[106,107,108,110,111],Le=/^ag5zfmtoYW4tYWNhZGVteX(?:I|J)(?:A|B|7|9|-|_)CxIIVXNlckRhdGEi(?:Gm|GG|G2|Hm|HG|HW)thaWRf(?:M|N|O)(?:\w{34}|\w{29,31}|\w{27})(?:LEghGZWVkYmFjaxiAg[I-P](?:O|P|W|X|2|3)|DAsSCEZlZWRiYWNrGICA|MCxIIRmVlZGJhY2sYgI(?:C|D)|wLEghGZWVkYmFjaxiAg|DAsSCEZlZWRiYWNrGICA)(?:[\w-]{5}|[\w-]{7,8})(?:M|DA|C(?:g|w|A|Q)w)$/,Mr=C(Le),f=a=>Le.test(a),Vr=[301],Me=/^kaencrypted_[a-z0-9]{32}_[a-z0-9]{256}$/,Qr=C(Me),_=a=>Me.test(a),ae=/^http:\/\/googleid\.khanacademy\.org\/(\d+)$/,Nr=C(ae),Ve=a=>ae.test(a),te=/^_gae_bingo_random:(\w+-\w+-\w+)$/,Br=C(te),Qe=a=>te.test(a),Ne=/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,Or=C(Ne),P=a=>Ne.test(a);var Be;(r=>r.query=`query getFullUserProfile($kaid: String, $username: String) {
  user(kaid: $kaid, username: $username) {
    id
    kaid
    key
    userId
    email
    username
    profileRoot
    gaUserId
    qualarooId
    isPhantom
    isDeveloper: hasPermission(name: "can_do_what_only_admins_can_do")
    isCurator: hasPermission(name: "can_curate_tags", scope: ANY_ON_CURRENT_LOCALE)
    isCreator: hasPermission(name: "has_creator_role", scope: ANY_ON_CURRENT_LOCALE)
    isPublisher: hasPermission(name: "can_publish", scope: ANY_ON_CURRENT_LOCALE)
    isModerator: hasPermission(name: "can_moderate_users", scope: GLOBAL)
    isParent
    isTeacher
    isDataCollectible
    isChild
    isOrphan
    isCoachingLoggedInUser
    canModifyCoaches
    nickname
    hideVisual
    joined
    points
    countVideosCompleted
    bio
    profile {
      accessLevel
      __typename
    }
    soundOn
    muteVideos
    showCaptions
    prefersReducedMotion
    noColorInVideos
    newNotificationCount
    canHellban: hasPermission(name: "can_ban_users", scope: GLOBAL)
    canMessageUsers: hasPermission(name: "can_send_moderator_messages", scope: GLOBAL)
    isSelf: isActor
    hasStudents: hasCoachees
    hasClasses
    hasChildren
    hasCoach
    badgeCounts
    homepageUrl
    isMidsignupPhantom
    includesDistrictOwnedData
    canAccessDistrictsHomepage
    preferredKaLocale {
      id
      kaLocale
      status
      __typename
    }
    underAgeGate {
      parentEmail
      daysUntilCutoff
      approvalGivenAt
      __typename
    }
    authEmails
    signupDataIfUnverified {
      email
      emailBounced
      __typename
    }
    pendingEmailVerifications {
      email
      __typename
    }
    tosAccepted
    shouldShowAgeCheck
    birthMonthYear
    lastLoginCountry
    __typename
  }
  actorIsImpersonatingUser
  isAIGuideEnabled
  hasAccessToAIGuideDev
}
`)(Be||={});function oe(a,r){return c(`${p}/getFullUserProfile`,Be.query,typeof a=="string"?m(a)?{kaid:a}:{username:a}:a,r)}var Oe;(r=>r.query=`query getProfileWidgets($kaid: String!) {
  user(kaid: $kaid) {
    id
    kaid
    badgeCounts
    isChild
    profile {
      programs {
        id
        authorKaid
        authorNickname
        deleted
        displayableSpinoffCount
        imagePath
        key
        sumVotesIncremented
        translatedTitle: title
        url
        __typename
      }
      __typename
    }
    programs(sort: TOP, pageInfo: {itemsPerPage: 2}) {
      programs {
        id
        authorKaid
        authorNickname
        deleted
        displayableSpinoffCount
        imagePath
        key
        sumVotesIncremented
        translatedTitle: title
        url
        __typename
      }
      __typename
    }
    __typename
  }
  userSummary(kaid: $kaid) {
    statistics {
      answers
      comments
      flags
      projectanswers
      projectquestions
      questions
      replies
      votes
      __typename
    }
    __typename
  }
}
`)(Oe||={});function se(a,r){return c(`${p}/getProfileWidgets`,Oe.query,typeof a=="string"&&m(a)?{kaid:a}:a,r)}var Ge;(r=>r.query=`query getUserByUsernameOrEmail($username: String, $email: String) {
  user(username: $username, email: $email) {
    id
    kaid
    __typename
  }
}
`)(Ge||={});function ne(a,r){return c(`${p}/getUserByUsernameOrEmail`,Ge.query,typeof a=="string"?P(a)?{email:a}:{username:a}:a,r)}var $e;(r=>r.query=`query getUserHoverCardProfile($kaid: String!) {
  user(kaid: $kaid) {
    id
    nickname
    username
    bio
    avatar {
      name
      imageSrc
      __typename
    }
    points
    isPhantom
    isActor
    isCoachedByActor
    userSummaryIsVisibleToActor
    actorHasUserScopedPermission(capability: CAN_VIEW_USER_IDENTITY)
    __typename
  }
}
`)($e||={});function ie(a,r){return c(`${p}/getUserHoverCardProfile`,$e.query,typeof a=="string"?{kaid:a}:a,r)}var He;(r=>r.query=`query programQuery($programId: String!) {
  programById(id: $programId) {
    byChild
    category
    created
    creatorProfile: author {
      id
      nickname
      profileRoot
      profile {
        accessLevel
        __typename
      }
      __typename
    }
    deleted
    description
    spinoffCount: displayableSpinoffCount
    docsUrlPath
    flags
    flaggedBy: flaggedByKaids
    flaggedByUser: isFlaggedByCurrentUser
    height
    hideFromHotlist
    id
    imagePath
    isProjectOrFork: originIsProject
    isOwner
    kaid: authorKaid
    key
    newUrlPath
    originScratchpad: originProgram {
      deleted
      translatedTitle
      url
      __typename
    }
    restrictPosting
    revision: latestRevision {
      id
      code
      configVersion
      created
      editorType
      folds
      __typename
    }
    slug
    sumVotesIncremented
    title
    topic: parentCurationNode {
      id
      nodeSlug: slug
      relativeUrl
      slug
      translatedTitle
      __typename
    }
    translatedTitle
    url
    userAuthoredContentType
    upVoted
    width
    __typename
  }
}
`)(He||={});function le(a,r){return c(`${p}/programQuery`,He.query,typeof a=="number"?{programId:a.toString()}:typeof a=="string"?{programId:a}:a,r)}var je;(r=>r.query=`query projectsAuthoredByUser($kaid: String, $pageInfo: ListProgramsPageInfo, $sort: ListProgramSortOrder) {
  user(kaid: $kaid) {
    id
    programs(pageInfo: $pageInfo, sort: $sort) {
      complete
      cursor
      programs {
        id
        key
        authorKaid
        authorNickname
        displayableSpinoffCount
        imagePath
        sumVotesIncremented
        translatedTitle: title
        url
        __typename
      }
      __typename
    }
    __typename
  }
}
`)(je||={});function de(a,r){return c(`${p}/projectsAuthoredByUser`,je.query,a,r)}var We;(r=>r.query=`query QAExpandKeyInfo($encryptedKey: String) {
  qaExpandKeyInfo(encryptedQaExpandKey: $encryptedKey) {
    feedbackType
    unencryptedKey
    __typename
  }
}
`)(We||={});function pe(a,r){return c(`${p}/QAExpandKeyInfo`,We.query,typeof a=="string"?{encryptedKey:a}:a,r)}var Je={};Ie(Je,{LoginWithPasswordMutation:()=>Y,loginWithPasswordMutation:()=>ce});var Y;(e=>{e.query=`mutation loginWithPasswordMutation($identifier: String!, $password: String!) {
  loginWithPassword(identifier: $identifier, password: $password) {
    user {
      id
      kaid
      canAccessDistrictsHomepage
      isTeacher
      hasUnresolvedInvitations
      transferAuthToken
      preferredKaLocale {
        id
        kaLocale
        status
        __typename
      }
      __typename
    }
    isFirstLogin
    error {
      code
      __typename
    }
    __typename
  }
}
`;let r;(s=>(s.INVALID_CREDENTIALS="INVALID_CREDENTIALS",s.TOO_MANY_ATTEMPTS="TOO_MANY_ATTEMPTS"))(r=e.ErrorCode||={})})(Y||={});function ce(a,r){return c(`${p}/loginWithPasswordMutation`,Y.query,a,{headers:{"x-ka-fkey":Ae,Cookie:`fkey=${Ae}`},...r})}var F=class{constructor(r,e){return r instanceof i?this.client=r:e??=r,e&&this.copy(e),this}copy(r){return Object.assign(this,r),this}copyFromSchema(r){return this.rawData={...this.rawData,...r},this.copy(this.transformSchema(r))}isSchema(r){return this.is(this.transformSchema(r))}};var kr=(r=>(r.DOWNSTREAM_SERVICE_ERROR="DOWNSTREAM_SERVICE_ERROR",r))(kr||{}),br=(r=>(r.users="users",r))(br||{}),_r=(e=>(e.COACH="COACH",e.PUBLIC="PUBLIC",e))(_r||{}),Ze=(o=>(o.pjs="pjs",o.webpage="webpage",o.ace_sql="ace_sql",o.unknown="",o))(Ze||{}),be=(s=>(s.Challenge="Challenge",s.Interactive="Interactive",s.Project="Project",s.Scratchpad="Scratchpad",s.Talkthrough="Talkthrough",s))(be||{}),me=(u=>(u.ALL_PROJECT_ANSWER="ALL_PROJECT_ANSWER",u.ALL_PROJECT_QUESTION="ALL_PROJECT_QUESTION",u.ANSWER="ANSWER",u.COMMENT="COMMENT",u.PROGRAM="PROGRAM",u.PROJECTFEEDBACK="PROJECTFEEDBACK",u.PROJECT_CRITIQUE_ANSWER="PROJECT_CRITIQUE_ANSWER",u.PROJECT_CRITIQUE_QUESTION="PROJECT_CRITIQUE_QUESTION",u.PROJECT_EVAL_ANSWER="PROJECT_EVAL_ANSWER",u.PROJECT_EVAL_QUESTION="PROJECT_EVAL_QUESTION",u.PROJECT_HELP_ANSWER="PROJECT_HELP_ANSWER",u.PROJECT_HELP_QUESTION="PROJECT_HELP_QUESTION",u.QUESTION="QUESTION",u.REPLY="REPLY",u.SUGGESTED_CLARIFICATION="SUGGESTED_CLARIFICATION",u))(me||{}),wr=(o=>(o.AnswerFeedback="AnswerFeedback",o.BasicFeedback="BasicFeedback",o.LowQualityFeedback="LowQualityFeedback",o.QuestionFeedback="QuestionFeedback",o))(wr||{}),ze=(e=>(e[e.TopVoted=1]="TopVoted",e[e.Recent=2]="Recent",e))(ze||{}),Xe=(e=>(e.TOP="TOP",e.RECENT="RECENT",e))(Xe||{});var b=class extends F{static fromSchema(e){let t=new b;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){return new b({kaid:m(e)?e:void 0,username:!m(e)&&!P(e)?e:void 0,email:P(e)?e:void 0})}#e(){if(this.kaid)return this.kaid;if(this.username)return this.username;if(this.email)return this.email;throw new Error("User has no identifier")}transformSchema(e){return{emails:e.authEmails??void 0,badgeCounts:e.badgeCounts?JSON.parse(e.badgeCounts):void 0,bio:e.bio??void 0,canAccessDistrictsHomepage:e.canAccessDistrictsHomepage??void 0,canHellban:e.canHellban??void 0,canMessageUsers:e.canMessageUsers??void 0,canModifyCoaches:e.canModifyCoaches??void 0,completedVideos:e.countVideosCompleted,email:e.email??void 0,hasChildren:e.hasChildren??void 0,hasClasses:e.hasClasses??void 0,hasCoach:e.hasCoach??void 0,hasStudents:e.hasStudents??void 0,child:e.isChild??void 0,creator:e.isCreator??void 0,curator:e.isCurator??void 0,developer:e.isDeveloper??void 0,midsignupPhantom:e.isMidsignupPhantom??void 0,moderator:e.isModerator??void 0,orphan:e.isOrphan??void 0,parent:e.isParent??void 0,phantom:e.isPhantom??void 0,publisher:e.isPublisher??void 0,self:e.isSelf??void 0,teacher:e.isTeacher??void 0,joined:e.joined?new Date(e.joined):void 0,kaid:typeof e.kaid=="string"&&m(e.kaid)?e.kaid:typeof e.kaid=="string"?null:void 0,key:e.key??void 0,newNotifications:e.newNotificationCount??void 0,nickname:e.nickname??void 0,points:e.points??void 0,accessLevel:e.profile?.accessLevel,googleID:typeof e.userId=="string"&&Ve(e.userId)?e.userId.match(ae)[1]:typeof e.userId=="string"?null:void 0,qualarooID:typeof e.qualarooId=="string"&&Qe(e.qualarooId)?e.qualarooId.match(te)[1]:typeof e.qualarooId=="string"?null:void 0,username:e.username??(e.profileRoot?m(e.profileRoot.slice(9,-1))?null:e.profileRoot.slice(9,-1):e.username)}}async get(e=this.client??new i){let t=await e.getUser(this.#e());return this.copy(t)}async getAvatar(e=this.client??new i){let t=await e.getAvatar(this.#e());return this.copy({avatar:t}),t}async getStatistics(e=this.client??new i){let t=await e.getUserStatistics(this.#e());return this.copy({statistics:t})}async*getPrograms(e=this.client??new i,t,o){for await(let s of e.getUserPrograms(this.#e(),t,o))this.programs||this.copy({programs:[]}),s.forEach(n=>this.programs?.push(n)),yield s;return this}async getAllPrograms(e=this.client??new i,t,o){let s=await e.getAllUserPrograms(this.#e(),t,o);return this.copy({programs:s})}is(e){return!(this.kaid&&e.kaid)&&!(this.email&&e.email)&&!(this.key&&e.key)&&!(this.username&&e.username)&&!(this.googleID&&e.googleID)&&!(this.qualarooID&&e.qualarooID)?(console.warn("Users don't have any identifiers that can be compared"),!1):this.kaid&&e.kaid&&this.kaid===e.kaid||this.email&&e.email&&this.email===e.email||this.key&&e.key&&this.key===e.key||this.username&&e.username&&this.username===e.username||this.googleID&&e.googleID&&this.googleID===e.googleID||this.qualarooID&&e.qualarooID&&this.qualarooID===e.qualarooID||!1}};function Pr(a){return"data"in a&&!("errors"in a)}function Rr(a){return"errors"in a&&Array.isArray(a.errors)&&"data"in a}function Sr(a){return"errors"in a&&Array.isArray(a.errors)&&!("data"in a)}function h(a){if(Rr(a))throw new Error("Expected data response but got service errors response: "+a.errors.map(r=>r.message).join(", "));if(Sr(a))throw new Error("Expected data response but got input errors response: "+a.errors.map(r=>r.message).join(", "));if(!Pr(a))throw new Error("Expected data response but got unknown response")}function er(a){if(!B(a))throw new Error("Invalid program key");let r=atob(he(a)).split("").map(o=>o.charCodeAt(0)),e=r[17];if(e===20)r=r.slice(32,37);else if(e===23)r=r.slice(34,40);else throw new Error(`Unknown program key version: ${e}`);let t=0n;for(let o=0;o<r.length;o++)t|=BigInt(r[o]&127)<<BigInt(o*7);return Number(e===20?t:t<<14n)}function Gr(a){if(!Q(a))throw new Error("Invalid program ID");typeof a=="string"&&(a=parseInt(a));let r=a.toString(2).match(/.{1,7}(?=(.{7})*$)/g).map(t=>String.fromCharCode(parseInt(t.length===7?`1${t}`:t,2))).reverse().join(""),e=btoa(`js~khan-academyr${r.length===5?"":""}\v
Scratchpad${r}\f`);return e=ur(e),e}async function _e(a){if(m(a))return a;let e=await(await ne(a)).json();if(h(e),!e.data.user)throw new Error("User not found");let t=e.data.user.kaid;if(!m(t))throw new Error("User does not have a valid KAID");return t}async function rr(a){if(!m(a)&&!P(a))return a;m(a)||(a=await _e(a));let e=await(await ie(a)).json();if(h(e),!e.data.user)throw new Error("User not found");return e.data.user.username}function J(a){if(typeof a=="number"){if(!Q(a))throw new Error("Invalid program ID");return a}else if(De(a)){let r=a.match(N)[1];if(!Q(r))throw new Error("Invalid program URL");return parseInt(r,10)}else if(B(a)){if(a=er(a),!Q(a))throw new Error("Invalid program key");return a}else if(typeof a=="string"){if(!Q(a))throw new Error("Invalid program ID");return parseInt(a,10)}throw new Error("Invalid program identifier")}async function ar(a){if(f(a))return a;if(!_(a))throw new Error("Invalid encrypted message key");let e=await(await pe(a)).json();if(h(e),!e.data.qaExpandKeyInfo)throw new Error("Message key not found");return e.data.qaExpandKeyInfo.unencryptedKey}var tr=(o=>(o.ProcessingJS="pjs",o.HTML="webpage",o.SQL="ace_sql",o.Other="",o))(tr||{}),q,O,D=class extends F{constructor(){super(...arguments);K(this,q)}get spinoff(){return typeof this.origin<"u"?!!this.origin:null}get lines(){return this.code?this.code.split(`
`).length:null}get url(){return this.rawData?.url?`https://www.khanacademy.org${this.rawData.url}`:this.id?`https://www.khanacademy.org/computer-programming/-/${this.id}`:null}get shortUrl(){return this.id?`https://khanacademy.org/cs/-/${this.id}`:null}get thumbnailUrl(){return this.rawData?.imagePath?`https://www.khanacademy.org${this.rawData.imagePath}`:this.thumbnailID&&this.url?`${this.url}/${this.thumbnailID}.png`:null}static fromSchema(e){let t=new D;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){let t=J(e);return new D({id:t,key:typeof e=="string"&&B(e)?e:void 0})}transformSchema(e){return{id:e.id?parseInt(e.id,10):void 0,title:e.translatedTitle,author:e.authorKaid||e.authorNickname||e.creatorProfile?b.fromSchema({kaid:e.authorKaid,nickname:e.authorNickname,isChild:e.byChild??void 0,...e.creatorProfile}):void 0,created:(()=>{if(e.created)return e.revision?.created?new Date(Math.min(new Date(e.created).valueOf(),new Date(e.revision.created).valueOf())):new Date(e.created)})(),updated:(()=>{if(e.revision?.created)return e.created&&e.revision.created===e.created?null:new Date(e.revision.created)})(),width:e.width,height:e.height,votes:e.sumVotesIncremented,spinOffCount:e.spinoffCount??e.displayableSpinoffCount,code:e.revision?.code,hidden:e.hideFromHotlist,type:(()=>{switch(e.revision?.editorType){case"pjs":return D.Type.ProcessingJS;case"webpage":return D.Type.HTML;case"ace_sql":return D.Type.SQL;default:return D.Type.Other}})(),origin:(()=>{if(!e.originScratchpad)return e.originScratchpad;let t=("https://khanacademy.org"+e.originScratchpad.url).match(N)?.[1];if(!t){console.error(`Failed to parse origin program ID from URL: ${e.originScratchpad.url}`);return}return new D({id:parseInt(t,10),title:e.originScratchpad.translatedTitle,deleted:e.originScratchpad.deleted})})(),key:e.key,thumbnailID:e.imagePath&&re.test(e.imagePath)?parseInt(e.imagePath.match(re)[1],10):void 0,description:typeof e.description=="string"?e.description!==""?e.description:null:e.description,deleted:e.deleted??void 0,selfFlagged:e.flaggedByUser,selfVoted:e.upVoted}}async get(e=this.client??new i){if(!this.id&&!this.key)throw new Error("Program is missing ID and key");let t=await e.getProgram(this.id??this.key);return this.copy(t)}async*getTipsAndThanks(e=this.client??new i,t){for await(let o of e.getProgramTipsAndThanks(g(this,q,O).call(this),t))this.tipsAndThanks||this.copy({tipsAndThanks:[]}),o.forEach(s=>this.tipsAndThanks?.push(s)),yield o;return this}async getAllTipsAndThanks(e=this.client??new i,t){let o=await e.getAllProgramTipsAndThanks(g(this,q,O).call(this),t);return this.copy({tipsAndThanks:o})}async*getQuestions(e=this.client??new i,t){for await(let o of e.getProgramQuestions(g(this,q,O).call(this),t))this.questions||this.copy({questions:[]}),o.forEach(s=>this.questions.push(s)),yield o;return this}async getAllQuestions(e=this.client??new i,t){let o=await e.getAllProgramQuestions(g(this,q,O).call(this),t);return this.copy({questions:o})}async*getHelpRequests(e=this.client??new i,t){for await(let o of e.getProgramHelpRequests(g(this,q,O).call(this),t))this.helpRequests||this.copy({helpRequests:[]}),o.forEach(s=>this.helpRequests.push(s)),yield o;return this}async getAllHelpRequests(e=this.client??new i,t){let o=await e.getAllProgramHelpRequests(g(this,q,O).call(this),t);return this.copy({helpRequests:o})}is(e){return!(this.id&&e.id)&&!(this.key&&e.key)?(console.warn("Programs don't have any identifiers that can be compared"),!1):this.id&&e.id&&this.id===e.id||this.key&&e.key&&this.key===e.key||!1}},R=D;q=new WeakSet,O=function(){if(this.id)return this.id;if(this.key)return this.key;throw new Error("Program has no identifier")},R.Type=tr;var or=["blobby_green_style","blobby_yellow_style","blobby_blue_style","blobby_purple_style","area_52_yellow_style","area_52_blue_style","area_52_green_style","area_52_purple_style","eggleston_blue_style","eggleston_yellow_style","eggleston_green_style","eggleston_orange_style","scuttlebug_purple_style","scuttlebug_yellow_style","scuttlebug_blue_style","scuttlebug_green_style","boggle_yellow_style","boggle_blue_style","boggle_green_style","boggle_purple_style","sneak_peak_green_style","sneak_peak_yellow_style","sneak_peak_blue_style","sneak_peak_purple_style","stelly_blue_style","stelly_yellow_style","stelly_green_style","stelly_orange_style","cacteye_purple_style","cacteye_yellow_style","cacteye_blue_style","cacteye_green_style","leaf_green_style","leaf_blue_style","leaf_grey_style","leaf_red_style","leaf_orange_style","leaf_yellow_style","leafers_seed_style","leafers_seedling_style","leafers_sapling_style","leafers_tree_style","leafers_ultimate_style","piceratops_seed_style","piceratops_seedling_style","piceratops_sapling_style","piceratops_tree_style","piceratops_ultimate_style","duskpin_seed_style","duskpin_seedling_style","duskpin_sapling_style","duskpin_tree_style","duskpin_ultimate_style","primosaur_seed_style","primosaur_seedling_style","primosaur_sapling_style","primosaur_tree_style","primosaur_ultimate_style","starky_seed_style","starky_seedling_style","starky_sapling_style","starky_tree_style","starky_ultimate_style","aqualine_seed_style","aqualine_seedling_style","aqualine_sapling_style","aqualine_tree_style","aqualine_ultimate_style","spunky_sam_blue_style","spunky_sam_green_style","spunky_sam_orange_style","spunky_sam_red_style","marcimus_pink_style","marcimus_orange_style","marcimus_red_style","marcimus_purple_style","mr_pink_red_style","mr_pink_green_style","mr_pink_orange_style","female_robot_amelia_style","female_robot_ada_style","female_robot_grace_style","male_robot_johnny_style","male_robot_donald_style","male_robot_hal_style","orange_juice_squid_orange_style","purple_pi_purple_style","purple_pi_pink_style","purple_pi_teal_style","mr_pants_teal_style","mr_pants_green_style","mr_pants_orange_style","mr_pants_pink_style","mr_pants_purple_style","old_spice_man_green_style","old_spice_man_blue_style","winston_default_style","winston_baby_style","ohnoes_default_style","hopper_happy_style","hopper_jumping_style","hopper_cool_style"],sr=["blobby-green","blobby-yellow","blobby-blue","blobby-purple","area-52-yellow","area-52-blue","area-52-green","area-52-purple","eggleston-blue","eggleston-yellow","eggleston-green","eggleston-orange","scuttlebug-purple","scuttlebug-yellow","scuttlebug-blue","scuttlebug-green","boggle-yellow","boggle-blue","boggle-green","boggle-purple","sneak-peak-green","sneak-peak-yellow","sneak-peak-blue","sneak-peak-purple","stelly-blue","stelly-yellow","stelly-green","stelly-orange","cacteye-purple","cacteye-yellow","cacteye-blue","cacteye-green","leaf-green","leaf-blue","leaf-grey","leaf-red","leaf-orange","leaf-yellow","leafers-seed","leafers-seedling","leafers-sapling","leafers-tree","leafers-ultimate","piceratops-seed","piceratops-seedling","piceratops-sapling","piceratops-tree","piceratops-ultimate","duskpin-seed","duskpin-seedling","duskpin-sapling","duskpin-tree","duskpin-ultimate","primosaur-seed","primosaur-seedling","primosaur-sapling","primosaur-tree","primosaur-ultimate","starky-seed","starky-seedling","starky-sapling","starky-tree","starky-ultimate","aqualine-seed","aqualine-seedling","aqualine-sapling","aqualine-tree","aqualine-ultimate","spunky-sam","spunky-sam-green","spunky-sam-orange","spunky-sam-red","marcimus","marcimus-orange","marcimus-red","marcimus-purple","mr-pink","mr-pink-green","mr-pink-orange","robot_female_1","robot_female_2","robot_female_3","robot_male_1","robot_male_2","robot_male_3","orange-juice-squid","purple-pi","purple-pi-pink","purple-pi-teal","mr-pants","mr-pants-green","mr-pants-orange","mr-pants-pink","mr-pants-purple","old-spice-man","old-spice-man-blue","cs-winston","cs-winston-baby","cs-ohnoes","cs-hopper-happy","cs-hopper-jumping","cs-hopper-cool"];function $r(a){return sr[or.indexOf(a)]}function Hr(a){return or[sr.indexOf(a)]}function we(a){return`https://www.khanacademy.org/images/avatars/svg/${a}.svg`}function Pe(a){return`https://www.khanacademy.org/images/avatars/${a}.png`}function ue(a){return a.match(/^(?:https:\/\/www\.khanacademy\.org)?\/images\/avatars(?:\/svg)?\/(.*)\.(?:(?:svg)|(?:png))$/)?.[1]??null}function jr(a){let r=ue(a);return r?Pe(r):null}function Wr(a){let r=ue(a);return r?we(r):null}function xr(a){return a.replace(/[a-zA-Z]+, \d\d [A-Za-z0-9]+ \d{4} \d\d:\d\d:\d\d [a-zA-Z]+/g,"").replace(/; (Path|Expires|Max-Age|HttpOnly|Secure|SameSite)[^;,]*/g,"").replace(/,/g,";")}var L=class extends F{get bySelf(){return this.client?.user?this.byUser(this.client.user):!1}transformSchema(e){return{text:e.content,author:e.author&&b.fromSchema(e.author),program:(()=>{if(e.focus?.kind==="Scratchpad")return new R({id:typeof e.focus.id=="string"?parseInt(e.focus.id,10):void 0,title:e.focus.translatedTitle});if(e.focusUrl){let t=e.focusUrl.match(Ce);return!t||t.length<1?void 0:new R({id:parseInt(t[1],10)})}})(),created:e.date?new Date(e.date):void 0,key:e.expandKey,encryptedKey:e.key,deleted:e.appearsAsDeleted,verified:e.definitelyNotSpam,score:e.lowQualityScore,byVideoAuthor:e.fromVideoAuthor,selfFlagged:e.flaggedByUser}}byUser(e){return this.author?this.author.is(e):!1}is(e){return!(this.key&&e.key)&&!(this.encryptedKey&&e.encryptedKey)?(console.warn("Messages don't have any identifiers that can be compared"),!1):this.key&&e.key&&this.key===e.key||this.encryptedKey&&e.encryptedKey&&this.encryptedKey===e.encryptedKey||!1}};var G=(t=>(t[t.TipsAndThanks="COMMENT"]="TipsAndThanks",t[t.Question="QUESTION"]="Question",t[t.HelpRequest="PROJECT_HELP_QUESTION"]="HelpRequest",t))(G||{}),Re=class extends L{get selfVoted(){return this.client?.authenticated===!1?null:this.selfUpvoted?1:this.selfDownvoted?-1:0}static fromSchema(e){let t=new Re;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){return new Re({key:f(e)?e:void 0,encryptedKey:_(e)?e:void 0})}transformSchema(e){return{...super.transformSchema(e),votes:e.sumVotesIncremented,replyCount:e.replyCount,selfUpvoted:e.upVoted,selfDownvoted:e.downVoted}}copy(e){return super.copy(e)}async get(e=this.client??new i){if(!this.key&&!this.encryptedKey)throw new Error("Message does not have a key or encrypted key");let t=await e.getMessage(this.key??this.encryptedKey);return this.copy(t)}async getAllReplies(e=this.client??new i){if(!this.key&&!this.encryptedKey)throw new Error("Message does not have a key or encrypted key");let t=await e.getAllMessageReplies(this.key??this.encryptedKey);return this.copy({replies:t})}},d=Re;d.Type=G;var U=class extends d{static fromSchema(e){let t=new U;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){return new U({key:f(e)?e:void 0,encryptedKey:_(e)?e:void 0})}transformSchema(e){return{...super.transformSchema(e),question:e.question?k.fromSchema(e.question):void 0}}copy(e){return super.copy(e)}};var k=class extends d{static fromSchema(e){let t=new k;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){return new k({key:f(e)?e:void 0,encryptedKey:_(e)?e:void 0})}transformSchema(e){return{...super.transformSchema(e),answerCount:e.answerCount,old:e.isOld,answers:(()=>{if(!e.answers)return;let t=e.answers.map(o=>U.fromSchema(o));return t.forEach(o=>o.copy({question:this})),t})()}}copy(e){return super.copy(e)}};var E=class extends L{static fromSchema(e){let t=new E;return t.copyFromSchema(e),t.rawData=e,t}static fromIdentifier(e){return new E({key:f(e)?e:void 0,encryptedKey:_(e)?e:void 0})}transformSchema(e){return{...super.transformSchema(e),message:(()=>{if(!(typeof e.replyExpandKeys>"u")){if(typeof e.replyExpandKeys=="string"&&f(e.replyExpandKeys))return new d({key:e.replyExpandKeys});if(Array.isArray(e.replyExpandKeys))return new d({key:e.replyExpandKeys[0]})}})()}}copy(e){return super.copy(e)}copyFromSchema(e){return super.copyFromSchema(e)}async get(e=this.client??new i){if(!this.key&&!this.encryptedKey)throw new Error("Message does not have a key or encrypted key");let t=await e.getMessage(this.key??this.encryptedKey);return this.copy(t)}};var S=class extends d{static fromSchema(r){let e=new S;return e.copyFromSchema(r),e.rawData=r,e}static fromIdentifier(r){return new S({key:f(r)?r:void 0,encryptedKey:_(r)?r:void 0})}transformSchema(r){return{...super.transformSchema(r),votes:r.sumVotesIncremented,replyCount:r.replyCount,selfUpvoted:r.upVoted,selfDownvoted:r.downVoted}}copy(r){return super.copy(r)}};function nr(a){return a.feedbackType==="COMMENT"}function Yr(a){return a.feedbackType==="REPLY"}function ir(a){return a.feedbackType==="QUESTION"}function Jr(a){return a.feedbackType==="ANSWER"}var lr={[G.TipsAndThanks]:S,[G.Question]:k,[G.HelpRequest]:k};var M,$,H,T,Z,z,w,A,x=class{constructor(){K(this,M,void 0);K(this,$,void 0);K(this,H,void 0);K(this,T,new Map);K(this,Z,new Map);K(this,z,new Map);this.authenticated=!1;this.kaid=null;return this}async resolveCachedKaid(r){if(m(r))return r;if(l(this,T).has(r))return l(this,T).get(r);let e=await _e(r);return l(this,T).set(r,e),e}async resolveCachedUsername(r){if(!m(r)&&!P(r))return r;if(l(this,Z).has(r))return l(this,Z).get(r);let e=await rr(r);return l(this,Z).set(r,e),e}async resolveCachedFeedbackKey(r){if(f(r))return r;if(l(this,z).has(r))return l(this,z).get(r);let e=await ar(r);return l(this,z).set(r,e),e}get kaas(){return!this.authenticated||!l(this,H)?null:l(this,H).match(/KAAS=([^;]+)/)?.[1]??null}async login(r,e){var n;if(r&&(m(r)&&(r=await this.resolveCachedUsername(r)),fe(this,M,r)),e&&fe(this,$,e),!l(this,M)||!l(this,$))throw l(this,M)?l(this,$)?new Error("Missing username/email and password"):new Error("Missing password"):new Error("Missing username or email");let t=await ce({identifier:l(this,M),password:l(this,$)},{credentials:"include"}),o=await g(n=x,w,A).call(n,t);if(h(o),!o.data.loginWithPassword)throw new Error("Malformed response");if(o.data.loginWithPassword.error)switch(o.data.loginWithPassword.error.code){case Y.ErrorCode.INVALID_CREDENTIALS:throw new Error("Invalid Credentials error: Check your username/email and password");case Y.ErrorCode.TOO_MANY_ATTEMPTS:throw new Error("Too Many Attempts error: Rate-limited by Khan Academy");default:throw new Error("Unknown error code: "+o.data.loginWithPassword.error.code)}let s=t.headers.get("set-cookie");if(!s)throw new Error("No cookies returned: Something went wrong on Khan Academy's end");return fe(this,H,xr(s)),this.authenticated=!0,this.kaid=typeof o.data.loginWithPassword.user?.kaid=="string"&&m(o.data.loginWithPassword.user.kaid)?o.data.loginWithPassword.user.kaid:null,this.kaid===null&&console.warn(`User ${r??this.kaas??"unknown"} does not have a valid KAID`),o.data.loginWithPassword}async getUser(r){var n;if(!r&&!this.authenticated)throw new Error("Not authenticated: You need to login or provide an indentifier");let e=null;r&&P(r)&&(e=r,r=await this.resolveCachedKaid(r));let t=await oe(r,r?void 0:{credentials:"include",headers:{cookie:l(this,H)}}),o=await g(n=x,w,A).call(n,t);if(h(o),!o.data.user)throw new Error("User not found");let s=b.fromSchema(o.data.user);return s.client=this,!s.email&&e&&P(e)&&s.copy({email:e}),s.self&&(this.user=s),s.kaid&&(s.username&&!l(this,T).has(s.username)&&l(this,T).set(s.username,s.kaid),s.email&&!l(this,T).has(s.email)&&l(this,T).set(s.email,s.kaid)),s}async getAvatar(r=this.kaid??l(this,M),e="svg"){var n;if(!r)throw new Error("No identifier provided");m(r)||(r=await this.resolveCachedKaid(r));let t=await ee(r),o=await g(n=x,w,A).call(n,t);if(h(o),!o.data.user)throw new Error("User not found");let s=ue(o.data.user.avatar.imageSrc);if(!s)throw new Error("User has no avatar");return e==="svg"?we(s):Pe(s)}async getUserStatistics(r=this.kaid??l(this,M)){var o;if(!r)throw new Error("No identifier provided");m(r)||(r=await this.resolveCachedKaid(r));let e=await se(r),t=await g(o=x,w,A).call(o,e);if(h(t),!t.data.user)throw new Error("User not found");return{votes:t.data.userSummary.statistics.votes,tipsAndThanks:t.data.userSummary.statistics.comments,questions:t.data.userSummary.statistics.questions,answers:t.data.userSummary.statistics.answers,helpRequests:t.data.userSummary.statistics.projectquestions,helpRequestAnswers:t.data.userSummary.statistics.projectanswers,replies:t.data.userSummary.statistics.replies,flags:t.data.userSummary.statistics.flags}}async*getUserPrograms(r,e="TOP",t=40){if(!r&&!this.authenticated)throw new Error("Not authenticated: You need to login or provide an indentifier");if(r??=this.kaid??this.user?.username??this.user?.email,!r)throw new Error("Missing identifier for logged in user");let s={kaid:await this.resolveCachedKaid(r),pageInfo:{cursor:null,itemsPerPage:t},sort:e},n=async X=>{var u;let v=await de({...s,pageInfo:{...s.pageInfo,cursor:X}}),V=await g(u=x,w,A).call(u,v);if(h(V),!V.data.user)throw new Error("User not found");if(!V.data.user.programs.complete&&!V.data.user.programs.cursor)throw new Error("Cursor not found");let Se=V.data.user.programs.programs.map(ge=>{let pr=R.fromSchema(ge);return pr.client=this,pr}),ye=!V.data.user.programs.complete&&V.data.user.programs.cursor;return{programs:Se,cursor:ye}},{programs:y,cursor:I}=await n();for(yield y;I;)({programs:y,cursor:I}=await n(I)),yield y}async getAllUserPrograms(r,e="TOP",t=100){let o=[];for await(let s of this.getUserPrograms(r,e,t))o.push(...s);return o}async getProgram(r){var s;r=J(r);let e=await le(r),t=await g(s=x,w,A).call(s,e);if(h(t),!t.data.programById)throw new Error("Program not found");let o=R.fromSchema(t.data.programById);return o.client=this,this.user&&o.author?.kaid===this.kaid&&(o.copy({author:this.user}),console.debug(`Copied the client's user data to program ${o.title?`"${mr(o.title,32)}"`:o.id??"unknown"} because the program's author matches the client user`)),o}async getMessage(r){var n;f(r)||(r=await this.resolveCachedFeedbackKey(r));let e=await j({topicId:cr.toString(),focusKind:"Scratchpad",feedbackType:"COMMENT",currentSort:1,qaExpandKey:r}),t=await g(n=x,w,A).call(n,e);if(h(t),!t.data.feedback||!t.data.feedback.feedback||t.data.feedback.feedback.length===0)throw new Error("Message not found");let o=t.data.feedback.feedback[0],s;if(nr(o))s=S.fromSchema(o);else if(ir(o)){let y=k.fromSchema(o);if(y.key!==r){let I=y.answers?.find(X=>X.key===r);if(!I)throw new Error("Question or answer not found");s=I,s.copy({question:y})}else s=y}else throw new Error("Unknown message type");return s.client=this,this.user&&s.author?.kaid===this.kaid&&(s.copy({author:this.user}),console.debug(`Copied the client's user data to comment ${s.key??s.encryptedKey??"unknown"} because the comment's author matches the client user`)),s}async getTipsAndThanks(r){return this.getMessage(r)}async getQuestion(r){return this.getMessage(r)}async getAnswer(r){return this.getMessage(r)}async getReply(r){var y;let e=await this.getMessage(r);if(!e.key)throw new Error("Message has no key");let t=await W(e.key),o=await g(y=x,w,A).call(y,t);if(h(o),!o.data.feedbackReplies||o.data.feedbackReplies.length===0)throw new Error("Reply not found");let s=o.data.feedbackReplies.find(I=>I.expandKey===r||I.key===r);if(!s)throw new Error("Reply not found");let n=E.fromSchema(s);return n.client=this,n.copy({message:e}),this.user&&n.author?.kaid===this.kaid&&(n.copy({author:this.user}),console.debug(`Copied the client's user data to reply ${n.key??n.encryptedKey??"unknown"} because the reply's author matches the client user`)),n}async*getProgramMessages(r=d.Type.TipsAndThanks,e,t=1){e=J(e);let o={topicId:e.toString(),focusKind:"Scratchpad",feedbackType:r,currentSort:t},s=async I=>{var ye;let X=await j({...o,cursor:I}),v=await g(ye=x,w,A).call(ye,X);if(h(v),!v.data.feedback.feedback)throw new Error("Comments not found");if(!v.data.feedback.isComplete&&!v.data.feedback.cursor)throw new Error("Cursor not found");let dr=v.data.feedback.feedback.map(u=>{let ge=lr[r].fromSchema(u);return ge.client=this,ge}),Se=!v.data.feedback.isComplete&&v.data.feedback.cursor;return{messages:dr,cursor:Se}},{messages:n,cursor:y}=await s();for(yield n;y;)({messages:n,cursor:y}=await s(y)),yield n}async getAllProgramMessages(r=d.Type.TipsAndThanks,e,t=1){let o=[];for await(let s of this.getProgramMessages(r,e,t))o.push(...s);return o}async*getProgramTipsAndThanks(r,e=1){yield*this.getProgramMessages(d.Type.TipsAndThanks,r,e)}async getAllProgramTipsAndThanks(r,e=1){return this.getAllProgramMessages(d.Type.TipsAndThanks,r,e)}async*getProgramQuestions(r,e=1){yield*this.getProgramMessages(d.Type.Question,r,e)}async getAllProgramQuestions(r,e=1){return this.getAllProgramMessages(d.Type.Question,r,e)}async*getProgramHelpRequests(r,e=1){yield*this.getProgramMessages(d.Type.HelpRequest,r,e)}async getAllProgramHelpRequests(r,e=1){return this.getAllProgramMessages(d.Type.HelpRequest,r,e)}async getAllMessageReplies(r){var s;r=await this.resolveCachedFeedbackKey(r);let e=await W(r),t=await g(s=x,w,A).call(s,e);if(h(t),!t.data.feedbackReplies)throw new Error("Replies not found");return t.data.feedbackReplies.map(n=>{let y=E.fromSchema(n);return y.client=this,y})}},i=x;M=new WeakMap,$=new WeakMap,H=new WeakMap,T=new WeakMap,Z=new WeakMap,z=new WeakMap,w=new WeakSet,A=async function(r){try{return await r.json()}catch(e){let t=e instanceof Error?e.message:typeof e=="string"?e:"Unknown error";throw new Error(`Failed to parse response JSON: ${t}`)}},K(i,w);0&&(module.exports={Answer,BaseMessage,Client,EmailRegex,EmailRegexMatch,FeedbackFocusKind,FeedbackKeyRegex,FeedbackKeyRegexMatch,FeedbackSort,FeedbackType,FeedbackTypename,GoogleIDRegex,GoogleIDRegexMatch,KaidRegex,KaidRegexMatch,ListProgramSortOrder,MESSAGE_ENCRYPTED_KEY_LENGTHS,MESSAGE_KEY_LENGTHS,Message,MessageEncryptedKeyRegex,MessageEncryptedKeyRegexMatch,MessageType,PROGRAM_ID_LENGTHS,PROGRAM_KEY_LENGTHS,PROGRAM_URL_LOCALES,PROGRAM_URL_PATHS,PROGRAM_URL_TLDS,Program,ProgramEditorType,ProgramIDRegex,ProgramIDRegexMatch,ProgramImagePathRegex,ProgramImagePathRegexMatch,ProgramKeyRegex,ProgramKeyRegexMatch,ProgramType,ProgramURLRegex,ProgramURLRegexMatch,QualarooIDRegex,QualarooIDRegexMatch,Question,Reply,ServiceErrorCode,ServiceErrorName,TipsAndThanks,TypeToClass,User,UserAccessLevel,assertDataResponse,avatarNameToSlug,avatarNames,avatarSlugToName,avatarSlugs,convertAvatarPNGToSVG,convertAvatarSVGToPNG,extractAvatarSlug,generateAvatarPNG,generateAvatarSVG,isAnswerSchema,isDataResponse,isEmail,isEncryptedFeedbackKey,isFeedbackKey,isGoogleID,isInputErrorResponse,isKaid,isProgramID,isProgramKey,isProgramURL,isQualarooID,isQuestionSchema,isReplySchema,isServiceErrorsResponse,isTipsAndThanksSchema,mutations,programIDtoKey,programKeyToID,queries,resolveFeedbackKey,resolveKaid,resolveProgramID,resolveUsername});
//# sourceMappingURL=khan-api.min.cjs.map
